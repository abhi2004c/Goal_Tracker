# .github/workflows/deploy.yml

name: CI/CD Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '18'

jobs:
  # ==================== BUILD & TEST ====================
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
      
      - name: Install Backend Dependencies
        run: |
          cd backend
          npm install
      
      - name: Install Frontend Dependencies
        run: |
          cd frontend
          npm install
      
      - name: Build Frontend
        run: |
          cd frontend
          npm run build
        env:
          VITE_API_URL: ${{ vars.VITE_API_URL || 'http://localhost:5000/api' }}
      
      - name: Upload Frontend Build
        uses: actions/upload-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist/
          retention-days: 7

  # ==================== DEPLOY ====================
  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy Status
        run: |
          echo "âœ… Build successful - Ready for deployment"
          echo "Backend: Deploy to Render via GitHub integration"
          echo "Frontend: Deploy to Vercel via GitHub integration"
          echo "ðŸ“‹ Deployment checklist:"
          echo "1. Connect GitHub repo to Render for backend"
          echo "2. Connect GitHub repo to Vercel for frontend"
          echo "3. Set environment variables in deployment platforms"
          echo "4. Run database migrations after first deployment"